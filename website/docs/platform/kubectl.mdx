---
title: Platform for Kubernetes
sidebar_label: kubernetes
---

## authentik configuration

To support the integrations of authentik Platform with Kubeadm, you need to import the OAuth device code flow and create two application/provider pairs, a service account and a token in authentik.

### Create OAuth device code flow

If you have already deployed the authentik OAuth device code flow, skip to the next section.

1. Download the device code flow blueprint [file](https://raw.githubusercontent.com/goauthentik/platform/refs/heads/main/hack/authentik/blueprints/oauth2-device-code.yaml).
2. Log in to authentik as an administrator and open the authentik Admin interface.
3. Navigate to **Flows and Stages** > **Flows**.
4. Click **Import**
5. Select the downloaded blueprint and click **Import**.

Alternatively, manually create the flow by following the instructions in the [Device code flow documentation](https://docs.goauthentik.io/add-secure-apps/providers/oauth2/device_code/#create-and-apply-a-device-code-flow)

### Create an application and provider in authentik for CLI

If you have already deployed the authentik OAuth CLI application/provider pair, skip to the next section.

1. Log in to authentik as an administrator and open the authentik Admin interface.
2. Navigate to **Applications** > **Applications** and click **Create with Provider** to create an application and provider pair. (Alternatively you can first create a provider separately, then create the application and connect it with the provider.)
    - **Application**: provide a descriptive name (e.g. `authentik-cli`), an optional group for the type of application, the policy engine mode, and optional UI settings.
    - **Choose a Provider type**: select **OAuth2/OpenID Connect** as the provider type.
    - **Configure the Provider**: provide a name (or accept the auto-provided name), the authorization flow to use for this provider, and the following required configurations.
        - Set the **Client type** to `Public`.
        - Set the **Client ID** to `authentik-cli`.
        - Select any available signing key.
    - **Configure Bindings** _(optional)_: you can create a [binding](../add-secure-apps/flows-stages/bindings/) (policy, group, or user) to manage access to the application.

3. Click **Submit** to save the new application and provider.

### Create an application and provider in authentik for Kubernetes

1. Log in to authentik as an administrator and open the authentik Admin interface.
2. Navigate to **Applications** > **Applications** and click **Create with Provider** to create an application and provider pair. (Alternatively you can first create a provider separately, then create the application and connect it with the provider.)
    - **Application**: provide a descriptive name (e.g. `authentik-kubernetes`), an optional group for the type of application, the policy engine mode, and optional UI settings.
    - **Choose a Provider type**: select **OAuth2/OpenID Connect** as the provider type.
    - **Configure the Provider**: provide a name (or accept the auto-provided name), the authorization flow to use for this provider, and the following required configurations.
        - Set the **Client type** to `Public`.
        - Set the **Client ID** to `authentik-kubernetes`.
        - Select any available signing key.
        - Under **Machine-to-Machine authentication settings** select the previously created `authentik-cli` provider as a **Federated OIDC Provider**.
    - **Configure Bindings** _(optional)_: you can create a [binding](../add-secure-apps/flows-stages/bindings/) (policy, group, or user) to manage access to the application.

3. Click **Submit** to save the new application and provider.

## Kubernetes configuration

To integrate authentik Platform with your kubernetes deployment, you'll need to configure kubeadm.

### Configure kubeadm settings

Add the following `extraArgs` to your `kubeadm_config.yml` file:

```yaml
- name: oidc-client-id
  value: authentik-kubernetes
- name: oidc-groups-claim
  value: groups
- name: oidc-groups-prefix
  value: "oidc:"
- name: oidc-issuer-url
  value: https://authentik.company/application/o/<application-slug>/
- name: oidc-username-claim
  value: email
```

Run the following command to apply the changes to an existing Kubernetes cluster:

```sh
kubeadm upgrade apply <version> --config=kubeadm_config.yml
```

Where <version> matches the target Kubernetes version specified in your config file.

:::info Example config file
An example `kubeadm_config.yml` is available on the [authentik Platform GitHub repository](https://github.com/BeryJu/infrastructure/blob/main/roles/beryjuio_kube/templates/kubeadm_config.yml#L11-L20).
:::

## Usage
