/**
 * @file Sidebar configuration for documentation entries.
 *
 * @import { SidebarItemConfig } from "@docusaurus/plugin-content-docs/src/sidebars/types.js"
 */

import * as path from "node:path";
import { fileURLToPath } from "node:url";

import categories from "./categories.mjs";

import {
    collectReleaseFiles,
    createReleaseSidebarEntries,
    prepareReleaseEnvironment,
} from "@goauthentik/docusaurus-theme/releases/node";

const __dirname = fileURLToPath(new URL(".", import.meta.url));

const releases = collectReleaseFiles(path.join(__dirname));
const releaseEnvironment = prepareReleaseEnvironment();

//#region Developer

/**
 * @type {SidebarItemConfig}
 */

const developerCategory = {
    type: "category",
    label: "Developer Documentation",
    collapsed: true,
    link: {
        type: "doc",
        id: "developer-docs/index",
    },
    items: [
        {
            type: "link",
            href: releaseEnvironment.apiReferenceOrigin,
            label: "API Overview",
            className: "api-overview",
        },
        {
            type: "doc",
            id: "developer-docs/contributing",
            label: "Contributing",
        },

        //#region Environment

        {
            type: "category",
            label: "Development environment",
            link: {
                type: "doc",
                id: "developer-docs/setup/index",
            },
            items: [
                {
                    type: "autogenerated",
                    dirName: "developer-docs/setup",
                },
            ],
        },

        //#endregion

        //#region Writing documentation
        {
            type: "category",
            label: "Writing documentation",
            link: {
                type: "doc",
                id: "developer-docs/docs/writing-documentation",
            },
            items: [
                "developer-docs/docs/style-guide",

                {
                    type: "category",
                    label: "Templates",
                    link: {
                        type: "doc",
                        id: "developer-docs/docs/templates/index",
                    },
                    items: [
                        {
                            type: "autogenerated",
                            dirName: "developer-docs/docs/templates",
                        },
                    ],
                },
            ],
        },
        //#endregion

        {
            type: "doc",
            id: "developer-docs/releases/index",
        },

        "developer-docs/translation",
    ],
};

//#endregion

//#region Release Notes

/**
 * @type {SidebarItemConfig}
 */
const releaseNotesCategory = {
    type: "category",
    label: "Release Notes",
    link: {
        type: "generated-index",
        title: "Releases",
        slug: "releases",
        description: "Release Notes for recent authentik versions",
    },
    items: createReleaseSidebarEntries(releases),
};
//#endregion

//#region Sidebar Items

/**
 * @type {SidebarItemConfig[]}
 */
const items = [
    {
        type: "doc",
        id: "index",
    },
    ...categories.map(([dirName, label]) => {
        /**
         * @type {SidebarItemConfig}
         */
        const sidebarCategory = {
            type: "category",
            label,
            items: [
                {
                    type: "autogenerated",
                    dirName,
                },
            ],
        };

        return sidebarCategory;
    }),
    developerCategory,
    releaseNotesCategory,
];

//#endregion

/**
 * @type {SidebarItemConfig}
 */
const sidebar = {
    docs: items,
};

export default sidebar;
