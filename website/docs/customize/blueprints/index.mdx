---
title: Blueprints
---

Blueprints provide a way to template, automate, and distribute authentik configuration. Blueprints can be used to automatically configure instances, manage configurations-as-code without any external tools, and to distribute application configurations. Blueprints are YAML files, whose format is described further in [File structure](./v1/structure).

Blueprints are used to manage authentik default flows and other system objects. For example, authentik's `default-authentication-flow` is, under the covers, a blueprint.

Custom blueprints can be used to replace or modify default blueprints in certain circumstances. For example, you could modify the `default-authentication-flow` to change the layout of the login panel from the center to one side of the page.

## Types of blueprints

Blueprints can be applied in one of two ways:

- as a _Blueprint instance_
- as a _Flow import_

To _apply_ a blueprint means that the content in the blueprint file is initiated and used by authentik.

### Blueprint instance

- A Blueprint instance is a YAML file mounted into the authentik (worker) container. This file is read and applied regularly (every 60 minutes). Multiple instances can be created for a single blueprint file, and instances can be given context key:value attributes to configure the blueprint.

    :::info
    authentik watches for file modification/creation events in the blueprint directory and will automatically trigger a discovery when a new blueprint file is created, and trigger a blueprint apply when a file is modified.
    :::

### Flow import

- A Flow import is a YAML file uploaded via the browser/API. This file is validated and applied directly after being uploaded, but is not further monitored and nor is it automatically applied on startup like blueprint instances.

:::
Be aware of how editing a flow impacts the related blueprint file. For example, if you [modify and save](../../add-secure-apps/flows-stages/flow/#flow-configuration-options) an _existing default flow_, what you get is a merging of the two: the original flow plus any changes you made. If you want to revert any modifications that you made to the default flow and get a fresh start with the original default flow, you have to first delete the modified flow, and then create and apply the corollary default blueprint.

## Add or edit blueprints

...words here...

#### Add a new blueprint instance

steps here about using the Create button to add a default instance, select from the list...

...also need to cover how to edit one...


### Add a new Flow import

I have no idea how...

... also need to cover how to edit one...

## Blueprint Execution

When a blueprint is applied, all entries are processed within a single **atomic database transaction**. This means:

- If any entry fails validation or encounters an error, the **entire blueprint is rolled back**
- No partial changes are committed - it's all-or-nothing
- This ensures database consistency and prevents incomplete configurations

Additionally, all blueprints have access to built-in context variables:

- `goauthentik.io/enterprise/licensed`: Boolean indicating if an enterprise license is active
- `goauthentik.io/rbac/models`: Dictionary of available RBAC models

These can be accessed using the `!Context` tag, for example:

```yaml
conditions:
    - !Context goauthentik.io/enterprise/licensed
```

## Storage - File

The authentik container by default looks for blueprints in `/blueprints`. Underneath this directory, there are a couple default subdirectories:

- `/blueprints/default`: Default blueprints for default flows, tenants, etc
- `/blueprints/example`: Example blueprints for common configurations and flows
- `/blueprints/system`: System blueprints for authentik managed Property mappings, etc

Any additional `.yaml` file in `/blueprints` will be discovered and automatically instantiated, depending on their labels.

To disable existing blueprints, an empty file can be mounted over the existing blueprint.

File-based blueprints are automatically removed once they become unavailable, however none of the objects created by those blueprints are affected by this.

:::info
Please note that, by default, blueprint discovery and evaluation is not guaranteed to follow any specific order.

If you have dependencies between blueprints, you should use [meta models](./v1/meta#authentik_blueprintsmetaapplyblueprint) to make sure that objects are created in the correct order.
:::

## Storage - OCI

Blueprints can also be stored in remote [OCI](https://opencontainers.org/) compliant registries. This includes GitHub Container Registry, Docker hub and many other registries.

To download a blueprint via OCI, set the path to `oci://ghcr.io/<username>/<package-name>:<ref>`. This will fetch the blueprint from an OCI package hosted on GHCR.

To fetch blueprints from a private registry with authentication, credentials can be embedded into the URL.

Blueprints are re-fetched each execution, so when using changing tags, blueprints will automatically be updated.

To push a blueprint to an OCI-compatible registry, [ORAS](https://oras.land/) can be used with this command

```
oras push ghcr.io/<username>/blueprint/<blueprint name>:latest <yaml file>:application/vnd.goauthentik.blueprint.v1+yaml
```

## Storage - Internal

Blueprints can be stored in authentik's database, which allows blueprints to be managed via external configuration management tools like Terraform.

Modifying the contents of a blueprint will trigger its reconciliation. Blueprints are validated on submission to prevent invalid blueprints from being saved.
