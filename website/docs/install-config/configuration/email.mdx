---
title: Email Configuration
---

:::warning
Some hosting providers block outgoing SMTP ports, in which case you'll have to host an SMTP relay on a different port with a different provider.
:::

## Testing email configuration

To test if an email stage, or the global email settings are configured correctly, you can use the following command on your authentik server:

```shell
ak test_email <to_address> [-S <stage_name>]
```

If you omit the `-S` parameter, the email will be sent using the global settings. Otherwise, the settings of the specified stage will be used.

To run this command via Docker Compose:

```shell
docker compose exec worker ak test_email [...]
```

To run this command with Kubernetes:

```shell
kubectl exec -it deployment/authentik-worker -c worker -- ak test_email [...]
```

## Google Workspace SMTP relay configuration

To send email through Google SMTP servers, the easiest and most reliable method is often to use [Google's SMTP relay service](https://support.google.com/a/answer/2956491). Google provides detailed guidance in their documentation: [Send email from a printer, scanner, or app](https://support.google.com/a/answer/176600?hl=en).

Configuration can be confusing, as there is a lot of conflicting information available online.

First, confirm the outbound IP address that authentik will use to send emails. [Follow Google's documentation](https://support.google.com/a/answer/2956491) to add the IP address or addresses to the **SMTP relay service** options in your workspace's Gmail settings.

    - Set **Allowed Senders** to `Only addresses in my domains`.
    - Set **Authentication** to `Only accept mail from the specified IP addresses`.
    - Do not set **Require SMTP Authentication**.
    - Select **Require TLS encryption**.

If you are using Docker Compose, set the following environment variables for authentik:

```yaml
AUTHENTIK_EMAIL__HOST=smtp-relay.gmail.com
AUTHENTIK_EMAIL__PORT=587
AUTHENTIK_EMAIL__USE_TLS=true
AUTHENTIK_EMAIL__USE_SSL=false
AUTHENTIK_EMAIL__TIMEOUT=30
```

Or, if you are using the Helm chart, set the following variables in the `email` section:

```yaml
email:
    host: "smtp-relay.gmail.com"
    port: 587
    use_tls: true
    use_ssl: false
    timeout: 30
```

Redeploy the authentik containers, and use the `ak test_email` command to confirm that email is working.
