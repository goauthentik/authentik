---
title: Integrate with FortiMail
sidebar_label: FortiMail
support_level: community
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

## What is FortiMail

> FortiMail is a secure email gateway from Fortinet that provides protection against phishing, spam, malware, and data loss for on-premises or cloud-hosted email environments.
>
> -- https://www.fortinet.com/products/email-security

## Preparation

The following placeholders are used in this guide:

- `authentik.company` is the FQDN of the authentik installation.
- `fortimailadmin.company` is the hostname (or IP) of your FortiMail admin interface.
- `fortimailuser.company` is the WAN-facing hostname of your FortiMail user/webmail portal.

:::info
This documentation lists only the settings that you need to change from their default values. Changing settings not mentioned in this guide can prevent single sign-on from working correctly.
:::

:::note
In FortiMail 7.6.4 and later, you can configure separate service providers for the admin and user/webmail portals. If you plan to use the user/webmail portal, avoid importing FortiMailâ€™s auto-generated metadata directly, as you would need to edit the ACS URL in that XML to replace the host with your user-facing FQDN.
:::

<Tabs
  defaultValue="admin"
  values={[
    { label: "Admin portal SSO", value: "admin" },
    { label: "User portal SSO", value: "user" },
  ]}>
  <TabItem value="admin">

## authentik configuration

Create a SAML application and provider in authentik using the FortiMail admin values.

1. Log in to authentik as an administrator and open the authentik Admin interface.
2. Navigate to **Applications** > **Applications** and click **Create with Provider** to create an application and provider pair.

- **Application**: provide a descriptive name such as `FortiMail Admin`, optionally assign a group, choose a policy engine mode, and configure any UI settings. Record the **slug** because it appears in the IdP URLs.
- **Choose a Provider type**: select **SAML Provider**.
- **Configure the Provider**:
    - Provide a name (or accept the auto-generated value) and select the authorization flow to use.
    - Set the **ACS URL** to `https://fortimailadmin.company/sso/SAML2/POST`.
    - Set the **Issuer** to `https://fortimailadmin.company/sp`.
    - Set the **Service Provider Binding** to `Post`.
    - Under **Advanced protocol settings**, choose any available certificate as the **Signing Certificate** and enable **Sign Assertions**. Ensure `authentik default SAML Mapping: Username` is selected as a **Selected User Property Mappings**; other mappings are optional and can be removed if not needed.
- **Configure Bindings** _(optional)_: create a [binding](/docs/add-secure-apps/flows-stages/bindings/) (policy, group, or user) to control which administrators see the FortiMail Admin application on the **My Applications** page.

3. Click **Submit** to save the application and provider.
4. Download the provider metadata (`metadata.xml`) from authentik so you can upload it in step 4 of the FortiMail configuration below.

## FortiMail configuration

1. Sign in to the FortiMail admin web interface.
2. Go to **System** > **Single Sign On** and select the **Setting** tab.
3. Enable **Single sign-on** and note the values that FortiMail displays (the ACS field is read-only):
    - **Entity ID**: `https://fortimailadmin.company/sp`
    - **Assertion consumer service (ACS) URL**: `https://fortimailadmin.company/sso/SAML2/POST`
4. Upload the authentik SAML metadata file you downloaded in the previous step.
5. Switch to the **Profile** tab and configure the attribute mapping:
    - Set **Attribute used to identify email address** to `http://schemas.goauthentik.io/2021/02/saml/username`.

:::note
FortiMail does not auto-provision administrator accounts through SSO. Create admin users manually and, for each account, set **Authentication type** to **Single Sign On** so they use the SAML provider.
:::

  </TabItem>
  <TabItem value="user">

## authentik configuration

Create a dedicated SAML provider in authentik for the FortiMail user portal.

1. Log in to authentik as an administrator and open the authentik Admin interface.
2. Navigate to **Applications** > **Applications** and click **Create with Provider** to create an application and provider pair.

- **Application**: provide a descriptive name such as `FortiMail User Portal`, optionally assign a group, choose a policy engine mode, and configure any UI settings. Record the **slug**.
- **Choose a Provider type**: select **SAML Provider**.
- **Configure the Provider**:
    - Provide a name (or accept the auto-generated value) and select the authorization flow to use.
    - Set the **ACS URL** to the value FortiMail displayed, after replacing the host with `fortimailuser.company` (for example, `https://fortimailuser.company/sp2/sso/SAML2/POST`).
    - Set the **Issuer** to `https://fortimailuser.company/sp`.
    - Set the **Service Provider Binding** to `Post`.
    - Under **Advanced protocol settings**, choose any available certificate as the **Signing Certificate** and enable **Sign Assertions**. Ensure `authentik default SAML Mapping: Email` is selected as a **Selected User Property Mapping**; other mappings are optional and can be removed if not needed.
- **Configure Bindings** _(optional)_: create a [binding](/docs/add-secure-apps/flows-stages/bindings/) to control which end users see the FortiMail webmail application on the **My Applications** page.

3. Click **Submit** to save the application and provider.
4. Download the provider metadata (`metadata.xml`) from authentik so you can upload it in step 3 of the FortiMail configuration below.

## FortiMail configuration

1. In the FortiMail admin web interface, go to **System** > **Single Sign On**, enable **Use different service provider for admin and webmail access**, and select the **Webmail** service provider.
2. For the user/webmail service provider, note the values that FortiMail displays. The ACS field is read-only, so adjust the host portion when you copy it into authentik:
    - **Entity ID**: `https://fortimailuser.company/sp`
    - **Assertion consumer service (ACS) URL**: replace the host portion with `fortimailuser.company` (for example, `https://fortimailuser.company/sp2/sso/SAML2/POST`)
3. Upload the authentik SAML metadata file you downloaded in the previous step.
4. On the **Profile** tab for the user/webmail provider, set **Attribute used to identify email address** to `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress`.

  </TabItem>
</Tabs>

## Configuration verification

1. Open a new browser session (or private window) and navigate to the relevant FortiMail portal (admin or user).
2. Initiate the SSO login flow (this happens automatically if you enabled the SSO-only options below) and confirm that you are redirected to authentik for authentication. Sign in with an account permitted to use that portal.
3. After successful authentication, verify that you return to the FortiMail portal without being prompted for additional credentials.

## Enforce SSO-only access

To require SSO for all FortiMail logins:

- **Admin portal**: go to **System** > **Customization** > **Appearance** > **Webmail Portal** and set **Login page** to **Single Sign On only**.
- **User/webmail portal**: go to **Domain & Users** > **Domain**, edit the domain entry, then open **Advanced Setting** > **Other** and set **Webmail single sign on** to the SSO profile you created for end users.
