---
title: Integrate with ownCloud
sidebar_label: ownCloud
---

<span class="badge badge--secondary">Support level: Community</span>

## What is ownCloud

> ownCloud is a free and open-source software project for content collaboration and sharing and syncing of files.
>
> -- https://owncloud.com

:::note
This guide focuses on ownCloud installations that are deployed using Docker. If you deployed ownCloud using a different mechanism, there might be some differences in the process.
:::

## Preparation

The following placeholders are used in this guide:

- `owncloud.company` is the FQDN of the ownCloud install.
- `authentik.company` is the FQDN of the authentik install.

:::info
This guide will focus on setting up ownCloud using the [official OIDC plugin](https://github.com/owncloud/openidconnect). Advanced configuration details can be found in the [ownCloud admin manual](https://doc.owncloud.com/server/latest/admin_manual/configuration/user/oidc/oidc.html).
:::

## authentik Configuration

To support all ownCloud applications, multiple provider/application pairs are required—one each for the Web UI, Desktop application, Android application, and iOS application.  

The configuration for each application is nearly identical, except for the **Client ID** and **Client Secret**, which are [predefined](https://doc.owncloud.com/server/latest/admin_manual/configuration/user/oidc/oidc.html#client-ids-secrets-and-redirect-uris) by ownCloud for the Desktop, Android, and iOS applications.  

Follow these steps to configure authentik:

1. **Navigate to the authentik Admin Interface.**
2. Go to **Applications** > **Applications**.
3. Create the following **OAuth2/OpenID Connect** applications using the wizard.

### Configuration

#### General Settings

- **Name**: Use a descriptive name (e.g., `owncloud`, `owncloud-desktop`, `owncloud-android`, `owncloud-ios`).

#### Protocol Settings

- **Signing Key**: Select the signing key you wish to use.

#### Advanced Protocol Settings

- **Scopes**: `email`, `offline_access`, `openid`, `profile`

### Application-Specific Configuration

Configure the following settings differently for each ownCloud application:

#### Web UI

- **Protocol Settings**:
  - **Client ID**: Use the value generated by authentik (or customize as needed).
  - **Client Secret**: Use the value generated by authentik (or customize as needed).
  - **Redirect URIs**:  
    - Strict: `https://owncloud.company/apps/openidconnect/redirect`

#### Desktop Application

- **Protocol Settings**:
  - **Client ID**: Use the predefined value found in the [ownCloud admin manual](https://doc.owncloud.com/server/latest/admin_manual/configuration/user/oidc/oidc.html#client-id).
  - **Client Secret**: Use the predefined value found in the [ownCloud admin manual](https://doc.owncloud.com/server/latest/admin_manual/configuration/user/oidc/oidc.html#client-secret).
  - **Redirect URIs**:
    - Regex: `http://localhost:\d+`
    - Regex: `http://127.0.0.1:\d+`


#### Android Application

- **Protocol Settings**:
  - **Client ID**: Use the predefined value found in the [ownCloud admin manual](https://doc.owncloud.com/server/latest/admin_manual/configuration/user/oidc/oidc.html#client-id).
  - **Client Secret**: Use the predefined value found in the [ownCloud admin manual](https://doc.owncloud.com/server/latest/admin_manual/configuration/user/oidc/oidc.html#client-secret).
  - **Redirect URI**:  
    - Strict: `oc://android.owncloud.com`

#### iOS Application

- **Protocol Settings**:
  - **Client ID**: Use the predefined value found in the [ownCloud admin manual](https://doc.owncloud.com/server/latest/admin_manual/configuration/user/oidc/oidc.html#client-id).
  - **Client Secret**: Use the predefined value found in the [ownCloud admin manual](https://doc.owncloud.com/server/latest/admin_manual/configuration/user/oidc/oidc.html#client-secret).
  - **Redirect URI**:  
    - Strict: `oc://ios.owncloud.com`

### Service Discovery

To enable ownCloud applications to log in via OIDC, your reverse proxy must be configured to rewrite `https://owncloud.company/.well-known/openid-configuration` to `https://owncloud.company/index.php/apps/openidconnect/config`

Refer to the [ownCloud Admin Manual](https://doc.owncloud.com/server/latest/admin_manual/configuration/user/oidc/oidc.html#set-up-service-discovery) for an example configuration using [Apache HTTPD](https://httpd.apache.org/).  

For other reverse proxies, consult the provider-specific documentation for guidance on implementing this rewrite rule.

## ownCloud Configuration

To enable OIDC functionality in ownCloud, follow these steps:

1. **Navigate to the Market**:
   - Access the Market by visiting:  
     `https://owncloud.company/apps/market/#/`  
     or by clicking the **Hamburger Menu** in the top-left corner of any page in your ownCloud deployment and selecting **Market**.
   - Search for and enable the **OIDC plugin**.

2. **OIDC Plugin Configuration**:
   The OIDC plugin cannot be configured via the ownCloud UI. Configuration must be performed either:
   - Through the `config.php` file, or  
   - By storing the configuration in the ownCloud database.

   The location of the `config.php` file depends on your deployment method. Consult the setup guide for your chosen deployment method to identify the file’s location within your installation.

   :::note
   Instructions for configuring the OIDC plugin using the ownCloud database can be found in the OIDC plugin's [README.md file](https://github.com/owncloud/openidconnect?tab=readme-ov-file#settings-in-database). Both methods produce identical configurations, differing only in whether the settings are stored in a `php` file or in the database (via an `occ` command).
   :::

3. **Create the `oidc.config.php` File**:
   - Place a file named `oidc.config.php` in the same directory as the existing `config.php` file in your ownCloud installation.  
   - Files named with this pattern are treated as "override" files, allowing ownCloud to override matching configuration keys in the `config.php` file.

   The location of this file depends on your Docker configuration. By default, the file resides in `/mnt/data/config` within the container. This location is exposed via the `files` volume in the [official setup guide](https://doc.owncloud.com/server/next/admin_manual/installation/docker/#docker-compose).

4. **Minimal Contents of `oidc.config.php`**:  
   Add the necessary configuration settings to this file. Ensure it includes at least the minimal requirements for your setup:

   :::warning
  You can configure ownCloud to use either the `sub` or `preferred_username` as the UID field under `search-attribute`. When using `preferred_username` as the user identifier, ensure that the [**Allow users to change username** setting](https://docs.goauthentik.io/docs/sys-mgmt/settings#allow-users-to-change-username) is disabled to prevent authentication issues. The `sub` option uses a unique, stable identifier for the user, while `preferred_username` uses the username configured in authentik.
  :::

  ```php
  <?php
  $CONFIG = [
    'http.cookie.samesite' => 'None',
    'openid-connect' => [
      'provider-url' => 'https://authentik.company/application/o/owncloud/',
      'client-id' => <client id chosen in authentik provider configuration>,
      'client-secret' => <client secret chosen in authentik provider configuration>,
      'loginButtonName' => 'authentik Login',
      'mode' => 'userid',
      'search-attribute' => 'preferred_username',
      ],
    ],
  ];
  ```

Enable automatic provisioning of new users by augmenting `openid-connect` key in the above configuration with the following options:

```php
  'openid-connect' => [
    ... // configuration keys from above
    'auto-provision' => [
      'enabled' => true,
      'email-claim' => 'email',
      'display-name-claim' => 'given_name',
      'update' => [
        'enabled' => true,
      ],
    ],
  ],
```

:::note
The above configuration will result in new ownCloud users having the same username as the authentik user they are created from.
If you would prefer to use the email address as the ownCloud username, simply remove the `mode` and `search-attributes` from the above configuration.

This doesn't really impact anything, though if you elect to use the email address as the ownCloud username, the mobile apps will show the user's username as `user@emailaddress.com@owncloud.company` in the menus, which is kind of strange.
:::

Some other notable configuration options:

```php
<?php
$CONFIG = [
  'token_auth_enforced' => true,  // desktop/android/ios clients will be forced to login with OIDC,
                                  // and existing sessions will be disconnected
  'openid-connect' => [
    'autoRedirectOnLoginPage' => true,  // automatic redirection to authentik sign-in
    ],
  ],
];
```

:::warning
If you enable the `autoRedirectOnLoginPage` configuration and your OIDC setup breaks, you will have no way of logging in.
If this happens, simply disable this setting and restart ownCloud to re-enable the standard login page.
:::

:::tip
The OIDC plugin's [README](https://github.com/owncloud/openidconnect?tab=readme-ov-file#settings-in-database) contains information about other configuration options.
:::

### Done!

You should now be able to login using OIDC through authentik. If you did not set the `autoRedirectOnLoginPage` option to `true`, when you navigate to `https://owncloud.company` you will be presented with a login page that now includes an "authentik Login" button (or whatever text you chose in the `loginButtonName` field). If you did set it to `true`, when you attempt to access `https://owncloud.company` you will automatically be redirected to the authentik login page.

New connections through any of the ownCloud applications (desktop, android, or ios) will automatically use OIDC for authentication.
If you wish to force existing sessions to re-authenticate using OIDC, simply set the `token_auth_enforced`
option to `true` in your `oidc.config.php` file (as mentioned in [OIDC section](#owncloud-oidc-plugin) above).
Users will then be forced to re-auth in their ownCloud clients.
