:host {
    --app-details-border-color: var(--pf-global--BorderColor--100);
    --app-details-divider-color: var(--pf-global--BackgroundColor--100);
    --app-card-aspect-ratio: 4 / 3;
    --app-card-min-width: 6.5rem;
    --app-group-header-min-height: calc(var(--app-card-min-width) / 4);
    --app-icon-offset: 1rem;
    --app-group-border-color: var(--pf-global--BorderColor--100);
    --app-card-title-padding: 0.5rem;

    @media (min-width: 390px) {
        --app-card-title-padding: 0.25rem;
        --app-card-aspect-ratio: 1;
        --app-group-template-columns: repeat(auto-fill, var(--app-card-min-width));
    }

    @media (min-width: 409px) {
        --app-card-min-width: 7rem;
    }

    @media (min-width: 768px) {
        --app-icon-offset: 1.5rem;
        --app-card-min-width: 8rem;
    }

    @media (prefers-contrast: more) {
        --app-group-border-color: var(--pf-global--BorderColor--200);
    }
}

:host([theme="dark"]) {
    --app-details-border-color: var(--ak-dark-background-lighter);
    --app-details-divider-color: var(--pf-global--Color--300);
}

.card-header-aspect-wrapper {
    display: grid;
    grid-template-columns: 1fr;

    padding-inline: 1rem;
    padding-block: calc(var(--pf-global--LineHeight--md) * var(--app-card-title-padding));
    height: 100%;
    position: relative;
}

.pf-c-card {
    --pf-c-card--BoxShadow: var(--pf-global--BoxShadow--md-bottom);
    --pf-c-card--BackgroundColor: var(--pf-global--BackgroundColor--150);

    transition: box-shadow 150ms ease-in-out;
    border: 0.5px solid var(--pf-global--BorderColor--100);
    height: 100%;

    &:hover {
        --pf-c-card--m-hoverable--hover--BoxShadow: var(--pf-global--BoxShadow--xl-bottom);
    }

    .pf-c-card__header {
        padding: 0 !important;

        display: flex;
        flex: 1 1 auto;
        flex-flow: column;
        gap: var(--pf-global--spacer--md);
        justify-content: center;

        &:hover {
            text-decoration: none;

            .pf-c-card__title {
                text-decoration: underline;
            }
        }

        ak-app-icon {
            --icon-height: 50%;

            &::part(icon) {
                --app-icon--shadow-background-color: var(--pf-c-card--BackgroundColor);
                position: absolute;
                inset: 0;
                object-fit: contain;
                place-self: center;
                inset-block-end: var(--app-icon-offset, 0);
                padding: 0;
            }
        }
    }

    .pf-c-card__title {
        padding: 0 !important;
        place-content: end;
        z-index: 1;
        text-stroke-width: 0.15em;
        text-stroke-color: var(--pf-c-card--BackgroundColor);

        -webkit-text-stroke-width: 0.15em;
        -webkit-text-stroke-color: var(--pf-c-card--BackgroundColor);
        paint-order: stroke fill;

        .clamp-wrapper {
            display: box;
            display: -webkit-box;
            line-clamp: 2;
            -webkit-line-clamp: 2;
            box-orient: vertical;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-align: start;
            text-wrap: balance;
            line-height: 1.2;

            max-height: calc(var(--pf-global--LineHeight--md) * 2rem);
        }
    }
}

[part="app-group-header"] {
    grid-column: 1 / -1;
}

.app-details {
    display: none;
    background-color: var(--pf-global--BackgroundColor--100);
    box-shadow: none;
    border-block-start: 0.5px solid var(--app-details-divider-color);

    &::part(toggle) {
        background: var(--pf-c-drawer__content--BackgroundColor);
    }

    &::part(attachment-target) {
        background: var(--pf-c-drawer__content--BackgroundColor);
        border: 0.5px solid var(--app-details-border-color);
        border-block-start: 0;
        border-inline-start: var(--pf-c-expandable-section--m-display-lg--after--Width) solid
            var(--pf-c-expandable-section--m-display-lg--m-expanded--after--BackgroundColor);
        box-shadow: var(--pf-global--BoxShadow--xl-bottom);

        @media (min-width: 576px) {
            position: absolute;
            inset-inline: 0 -0.5px;
            inset-block-start: 100%;
            z-index: var(--pf-global--ZIndex--xs);
        }
    }

    &::part(content) {
        padding-block-start: var(--pf-global--spacer--md);
    }
}

[part="app-list"]:has([expanded]) {
    padding-block-end: 15rem;
}

[part="app-list"] {
    display: grid;
    gap: var(--pf-global--spacer--md);

    grid-template-columns: repeat(var(--app-list-column-count, 1), 1fr);
    justify-items: center;

    @media (max-width: 767px) {
        --app-list-column-count: 1 !important;
        justify-items: normal;
    }
}

[part="app-group"] {
    display: grid;
    gap: var(--pf-global--spacer--md);
    grid-template-columns: var(--app-group-template-columns, 1fr);
    width: round(down, 100%, calc(var(--app-card-min-width) / var(--app-list-column-count, 1)));
    grid-auto-rows: minmax(min-content, 0);

    @media (max-width: 767px) {
        width: auto;
        grid-template-rows: auto;
    }

    @media (min-width: 768px) {
        border-inline-start: 0.5px solid var(--app-group-border-color);
        padding-inline-start: calc(1rem - 0.5px);
    }
}

[part="app-group-separator"] {
    grid-column: 1 / -1;
    border-color: transparent;
}

[part="app-card"] {
    aspect-ratio: var(--app-card-aspect-ratio);

    &[aria-selected="true"] {
        outline: auto var(--ak-accent);
    }
}
